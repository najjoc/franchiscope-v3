<!DOCTYPE html>
<html>
<head>
  <title>FranchiScope</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    body {
      background-color: #ffffff;
      color: #333;
      font-family: Arial, sans-serif;
    }
    .logo-watermark {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 100px;
      opacity: 0.8;
      pointer-events: none;
    }

    /* NPS scale styles */
    .nps-scale {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .nps-box {
      position: relative;
      width: 40px;
      height: 40px;
      border-radius: 6px;
      cursor: pointer;
      font: 600 14px/40px Arial, sans-serif;
      text-align: center;
      color: #fff;
      transition: transform .15s;
    }

    .nps-box input { display: none; }

    .nps-box.det { background:#ff6b6b; }
    .nps-box.pas { background:#f9b44d; }
    .nps-box.pro { background:#2ecc71; }

    .nps-box:hover,
    .nps-box input:checked + span,
    .nps-box.selected {
      outline:3px solid #222;
      transform:scale(1.05);
    }
  </style>
</head>
<body>
  <h1>Welcome to FranchiScope</h1>

  <div class="section section-yellow">
    <form action="/home" method="POST">
      <label>I am a:</label>
      <select name="role" required>
        <option value="">Select your role</option>
        <option value="franchisee" <%= role === 'franchisee' ? 'selected' : '' %>>Franchisee</option>
        <option value="future-franchisee" <%= role === 'future-franchisee' ? 'selected' : '' %>>Future Franchisee</option>
        <option value="franchisor" <%= role === 'franchisor' ? 'selected' : '' %>>Franchisor</option>
        <option value="admin" <%= role === 'admin' ? 'selected' : '' %>>Admin</option>
      </select>
      <button type="submit">Continue</button>
    </form>
  </div>

  <hr>

  <% if (role === 'franchisee') { %>
    <div class="section section-blue">
      <h2>Submit Your Franchise Feedback</h2>
      <form action="/submit-feedback" method="POST" enctype="multipart/form-data">
        <label>Franchise Name:</label><br>
        <input type="text" name="franchiseName" required><br><br>

        <label>Your feedback:</label><br>
        <textarea name="info" required></textarea><br><br>

        <label>How likely are you to recommend this franchise? (0 = not at all, 10 = absolutely)</label><br>
        <div class="nps-scale">
          <% for (let i = 0; i <= 10; i++) { %>
            <label class="nps-box <%= i <= 6 ? 'det' : (i <= 8 ? 'pas' : 'pro') %>">
              <input type="radio" name="rating" value="<%= i %>" required>
              <span><%= i %></span>
            </label>
          <% } %>
        </div><br>

        <label>Upload contract (optional):</label><br>
        <input type="file" name="contractFile"><br><br>

        <button type="submit">Submit Feedback</button>
      </form>

      <br>
      <a href="/my-responses">View Responses from Franchisors</a>
      <br><br>
      <a href="/home">Back to Home</a>
    </div>
  <% } %>

  <% if (role === 'future-franchisee') { %>
    <div class="section section-green">
      <h2>Available Franchises</h2>
      <ul>
        <% franchises.forEach(function(f) { %>
          <li><a href="/feedback/<%= f %>"><%= f %></a></li>
        <% }); %>
      </ul>
      <br>
      <a href="/home">Back to Home</a>
    </div>
  <% } %>

  <% if (role === 'franchisor') { %>
    <div class="section section-blue">
      <h2>Franchisee Feedbacks (Respond as Franchisor)</h2>
      <form action="/franchisor-feedback" method="POST">
        <label>Select your franchise:</label><br>
        <select name="selectedFranchise" required>
          <option value="">Select a franchise</option>
          <% franchises.forEach(function(f) { %>
            <option value="<%= f %>" <%= f === selectedFranchise ? 'selected' : '' %>><%= f %></option>
          <% }); %>
        </select><br><br>
        <button type="submit">View Feedbacks</button>
      </form>

      <% if (message) { %>
        <p><%= message %></p>
      <% } %>

      <% if (selectedFranchise && feedbacks.length > 0) { %>
        <% feedbacks.forEach(function(f) { %>
          <% if (f.franchiseName === selectedFranchise) { %>
            <div class="section section-green">
              <h3><%= f.franchiseName %> (Rating: <%= f.rating %>)</h3>
              <p><%= f.info %></p>
              <form action="/respond-feedback/<%= f._id %>" method="POST">
                <input type="text" name="responder" placeholder="Your name" required><br><br>
                <textarea name="response" placeholder="Your response" required></textarea><br><br>
                <button type="submit">Submit Response</button>
              </form>
            </div>
          <% } %>
        <% }); %>
      <% } else if (selectedFranchise) { %>
        <p>No feedback available for this franchise yet.</p>
      <% } %>

      <br>
      <a href="/home">Back to Home</a>
    </div>
  <% } %>

  <% if (role === 'admin') { %>
    <div class="section section-yellow">
      <h2>Admin Access</h2>
      <a href="/admin">Go to Admin Page</a>
      <br><br>
      <a href="/home">Back to Home</a>
    </div>
  <% } %>

  <% if (role === 'franchisee' || role === 'future-franchisee') { %>
    <div class="section section-green">
      <a href="/my-chats">My Chats</a>
    </div>
  <% } %>

  <img src="/images/logo.png" alt="FranchiScope Logo" class="logo-watermark">

  <% if (!role) { %>
    <div class="founders-section">
      <button id="founders-btn">Contacts</button>
      <div id="founders-links" class="hidden">
        <a href="https://www.linkedin.com/in/charbel-al-najjar-a6708a21b" target="_blank">
          LinkedIn: Charbel Al Najjar
        </a><br>
        <a href="https://www.linkedin.com/in/ghina-harajly-8426ab290" target="_blank">
          LinkedIn: Ghina Harajly
        </a>
      </div>
    </div>
  <% } %>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const btn = document.getElementById('founders-btn');
      const links = document.getElementById('founders-links');
      if (btn) {
        btn.addEventListener('click', () => {
          links.classList.toggle('hidden');
        });
      }

      // âœ… NPS highlight on selection
      document.querySelectorAll('.nps-box input').forEach(radio => {
        radio.addEventListener('change', e => {
          document.querySelectorAll('.nps-box').forEach(b => b.classList.remove('selected'));
          e.target.closest('.nps-box').classList.add('selected');
        });
      });
    });
  </script>

</body>
</html>
